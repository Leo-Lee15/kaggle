---
title: "Paid Vacation - Brazil's House of Deputies"
author: "Caio Lente"
date: "2017-02-12"
output: 
  html_document: 
    fig_height: 7
    fig_width: 10
---

```{r setup, include=FALSE}
# Knitr options
knitr::opts_chunk$set(echo = TRUE)

# Load libraries
library(plotly)
library(tidyverse)
library(lubridate)

# Read data
deputies <- read_csv("Data/dirty_deputies_v2.csv")

# Get summary of each type of refund
desc_summ <- deputies %>%
  group_by(refund_description) %>%
  summarise(
    refund_cnt = n(),
    refund_avg = mean(refund_value),
    refund_tot = sum(refund_value)
  ) %>%
  ungroup()
```

My goal with this analysis is to find out whether Brazilian deputies
have been using their reimbursement rights inadequately.

These reimbursements are called Quota for the Exercise of Parliamentary
Activity and are "designated to pay for expenses exclusively linked to
the execise of parliamentary activity". Therefore, as far as I could tell,
there are two main ways we could detect an improper reimbursement claim
(given the available data):
* If the refund category is suspicious or
* If the time component of the refund is suspicious

## Dissemination of Parliamentary Activity

To investigate suspicious refund categories I tried plotting a bar chart
of total refunds per category. Much to my surprise, I had already found
something very weird.

```{r reorder_descriptions, include=FALSE}
# Arrange descriptions according to total value
desc_summ <- desc_summ %>%
  arrange(refund_tot)

# Reorder deputies according to median
desc_summ$refund_description <- ordered(
  desc_summ$refund_description,
  levels = desc_summ$refund_description
)
```

```{r bar_plot, warning=FALSE}
# Plot total value of refunds
desc_summ %>%
  plot_ly(
    x = ~refund_description,
    y = ~refund_tot,
    type = "bar",
    color = ~refund_description
  ) %>%
  layout(
    legend = list(orientation = 'h'),
    xaxis = list(
      showticklabels = FALSE,
      title = ""
    )
  )
```

Apparently "dissemination of parliamentary activity" is the category
that has had the highest overall cost for the taxpayer: a total of
R$48,645,429.54. Since this refund description is very vague, it seems
to me that it is being widely used by the deputies as a cover up improper
refunds.

Just to make sure I wasn't being too quick to judge, I decided to look
into this a little further and ceated a box-plot for each category.

```{r reorder_deputies, include=FALSE}
# Get median of refunds for each deputy
d <- deputies %>%
  group_by(refund_description) %>%
  summarise(med = median(refund_value)) %>%
  arrange(med) %>%
  select(refund_description)

# Reorder deputies according to median
deputies$refund_description <- ordered(
  deputies$refund_description,
  levels = d$refund_description
)
```

```{r box_plots, warning=FALSE}
# Plot refund descriptions
deputies %>%
  plot_ly(
    x = ~refund_description,
    y = ~refund_value,
    type = "box",
    color = ~refund_description
  ) %>%
  layout(
    legend = list(orientation = 'h'),
    xaxis = list(
      showticklabels = FALSE,
      title = ""
    )
  )
```

In the image above, dissemination of parliamentary activity doesn't have
the highest median, but it's outliers stand out from the rest. If we
examine to top outlier of this category (and of the whole plot), we find
that it corresponds to R$184,500.00 being reimbursed for expenses at a
*small print shop*, corroborating to the hypothesis that this category
is in fact being misused by the deputies.






